<!doctype html>
<html lang="en">
<head>
    <title>Leap VR Quickstart</title>
    <meta charset="utf-8">
    <style>
        body {
            font-family: Monospace;
            margin: 0;
            padding: 0;
        }

    </style>

    <script src="//cdnjs.cloudflare.com/ajax/libs/three.js/r69/three.js"></script>
    <!-- These two scripts are brought in from the THREE.js repo -->
    <!-- VREffect has been slightly customized, see https://github.com/mrdoob/three.js/pull/5523 -->
    <script src="js/VRControls.js"></script>
    <script src="js/VREffect.js"></script>

    <script src="//js.leapmotion.com/leap-0.6.3.min.js"></script>
    <script src="//js.leapmotion.com/leap-plugins-0.1.9.min.js"></script>
</head>

<body>

<canvas id="scene"></canvas>

<p>
    Notes on this example
</p>
<ul>
    <li> Units are in meters. </li>
    <li> It is a really really good idea to set up 60Hz refresh rate. </li>
    <li> The positional tracker light will blink once when plugged in to indicate readyness, and be on consistently when tracking. </li>
</ul>

</body>

//scene config and 3D word related stuff
<script src="js/SceneStuff.js"></script>


<script>
    //
    // ADD LEAP MOTION
    //
    //

    // Connect to localhost and start getting frames
    Leap.loop();

    // Docs: http://leapmotion.github.io/leapjs-plugins/main/transform/
    Leap.loopController.use('transform', {

        // This matrix flips the x, y, and z axis, scales to meters, and offsets the hands by -8cm.
        vr: true,

        // This causes the camera's matrix transforms (position, rotation, scale) to be applied to the hands themselves
        // The parent of the bones remain the scene, allowing the data to remain in easy-to-work-with world space.
        // (As the hands will usually interact with multiple objects in the scene.)
        effectiveParent: camera

    });

    // Docs: http://leapmotion.github.io/leapjs-plugins/main/bone-hand/
    Leap.loopController.use('boneHand', {

        // If you already have a scene or want to create it yourself, you can pass it in here
        // Alternatively, you can pass it in whenever you want by doing
        // Leap.loopController.plugins.boneHand.scene = myScene.
        scene: scene,

        // Display the arm
        arm: true

    });



    //
    // ADD VIRTUAL REALITY
    //
    //

    // Moves (translates and rotates) the camera
    var vrControls = new THREE.VRControls(camera);

    var vrEffect = new THREE.VREffect(renderer);


    var onkey = function(event) {
        if (event.key === 'z') {
            vrControls.zeroSensor();
        }
        if (event.key === 'f') {
            return vrEffect.setFullScreen(true);
        }
    };

    window.addEventListener("keypress", onkey, true);


    //stay in index.html
    //
    // MAKE IT GO
    //
    //

    var render = function() {
        vrControls.update();
        vrEffect.render(scene, camera);

        requestAnimationFrame(render);
    };

    render();


    //
    // Add a debug message Real quick
    // Prints out when receiving oculus data.
    //
    //

    var receivingPositionalData = false;
    var receivingOrientationData = false;

    var timerID = setInterval(function(){

        if (camera.position.x !== 0 && !receivingPositionalData){
            receivingPositionalData = true;
            console.log("receiving positional data");
        }

        if (camera.quaternion.x !== 0 && !receivingOrientationData){
            receivingOrientationData = true;
            console.log("receiving orientation data");
        }

        if (receivingOrientationData && receivingPositionalData){
            clearInterval(timerID);
        }

    }, 2000);




</script>
</html>
